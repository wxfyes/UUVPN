# UUVPN API服务器部署说明

## 🖥️ 宝塔面板部署步骤

### 第一步：创建网站

1. **登录宝塔面板**
2. **添加站点**：
   - 域名：`api.yourdomain.com`（替换为你的域名）
   - 根目录：`/www/wwwroot/api.yourdomain.com`
   - PHP版本：选择PHP 7.4或8.0
   - 数据库：暂时不需要

### 第二步：上传文件

将以下文件上传到网站根目录：

1. **`config.php`** - 简单的配置接口
2. **`api/index.php`** - 完整的API服务器
3. **`.htaccess`** - Apache重写规则

### 第三步：配置域名解析

在你的域名管理面板中添加A记录：
- 主机记录：`api`
- 记录值：你的服务器IP地址

### 第四步：修改配置

编辑 `config.php` 或 `api/index.php` 文件，修改以下配置：

```php
$config = [
    "baseURL" => "https://api.yourdomain.com/api/v1/",  // 修改为你的域名
    "baseDYURL" => "https://api.yourdomain.com/api/vpnnodes.php",
    "mainregisterURL" => "https://yourdomain.com/#/register?code=",  // 修改为你的域名
    "paymentURL" => "https://yourdomain.com/payment",
    "telegramurl" => "https://t.me/yourchannel",  // 修改为你的Telegram群组
    "kefuurl" => "https://yourdomain.com/support",
    "websiteURL" => "https://yourdomain.com",  // 修改为你的网站
    "crisptoken" => "your-crisp-token-here",  // 修改为你的Crisp token
    "banners" => [
        "https://yourdomain.com/banner1.png",  // 修改为你的图片地址
        "https://yourdomain.com/banner2.png",
        "https://yourdomain.com/banner3.png"
    ],
    "message" => "OK",
    "code" => 1
];
```

### 第五步：测试API

在浏览器中访问以下地址测试：

1. **配置接口**：`https://api.yourdomain.com/config`
2. **完整API**：`https://api.yourdomain.com/api/config`

应该返回JSON格式的配置数据。

### 第六步：修改Android应用配置

在Android项目中修改 `ApiClient.kt` 文件：

```kotlin
object ApiClientConfig {
    private const val ConfigURL = "https://api.yourdomain.com/api/" // 修改这里
    const val ConfigNodeURL = ""
}
```

## 🔧 高级配置

### 数据库集成

如果需要连接数据库，可以在PHP文件中添加：

```php
<?php
// 数据库连接配置
$db_host = 'localhost';
$db_name = 'your_database';
$db_user = 'your_username';
$db_pass = 'your_password';

try {
    $pdo = new PDO("mysql:host=$db_host;dbname=$db_name;charset=utf8mb4", $db_user, $db_pass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch(PDOException $e) {
    echo json_encode(['error' => 'Database connection failed'], JSON_UNESCAPED_UNICODE);
    exit();
}
?>
```

### SSL证书配置

在宝塔面板中：
1. 进入网站设置
2. 点击"SSL"
3. 申请Let's Encrypt免费证书
4. 开启"强制HTTPS"

### 安全配置

1. **修改默认端口**（可选）
2. **设置防火墙规则**
3. **定期备份数据**
4. **监控服务器状态**

## 📱 测试账号

在 `api/index.php` 中配置的测试账号：
- 邮箱：`test@example.com`
- 密码：`password123`

## 🚀 部署完成

部署完成后，你的API服务器将支持：

- ✅ 配置信息获取
- ✅ 用户登录/注册
- ✅ 用户信息查询
- ✅ 订阅信息获取
- ✅ 套餐列表获取

## 📞 技术支持

如果遇到问题：
1. 检查宝塔面板错误日志
2. 确认域名解析是否正确
3. 验证SSL证书是否有效
4. 测试API接口是否可访问
